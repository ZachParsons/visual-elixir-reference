\matrix [fptk, list=a] {
    \elem{1} &
    \elem{2} &
    \elem{3} &
    \elem{4} &
    \elem{5} &
    \elem{6} &
    \elem{7} &
    \elem{8} &
    \elemsafter \\
};

\foreach \i/\k in {1/1, 2/2, 3/2, 4/3, 5/4, 6/4, 7/4, 8/2}{
    \applyfuntop{a\i.north}{$k_\k$}
    \coordinate (k\i) at (last applied fun value);
}

\draw [fptk, group]
    (k2) -- (k3)
    (k5) -- (k7)
;

\matrix [fptk, list=b] [below=2 of a] {
    \elemx{1}{$a_1$} &
    \elemx{2}{$a_2$} &
    \elemx{4}{$a_4$} &
    \elemx{5}{$a_5$} &
    \elemx{8}{$a_8$} &
    \elemsafter \\
};

\foreach \i in {1,2,4,5,8}{
    \draw [fptk, flow ->=soft] (a\i.south) -- (b\i.north);
}
