\matrix [fptk, list=a] {
    \elem{1} &
    \elem{2} &
    \elem{3} &
    \elem{4} &
    \elem{5} &
    \elem{6} &
    \elemsafter \\
};

\foreach \i/\r in {1/1, 2/1, 3/2, 4/1, 5/3, 6/3}{
    \applyfuntop{a\i.north}{$k_\r$}
    \coordinate (k\i) at (last applied fun value);
}

\draw [fptk, group] (k1) -- (k2);
\draw [fptk, group] (k3) -- (k3);
\draw [fptk, group] (k4) -- (k4);
\draw [fptk, group] (k5) -- (k6);

\matrix [fptk, listx={b}{1.25}, below=2 of a] {
    \placeholder[1]{2.25} &
    \placeholder[2]{1.25} &
    \placeholder[3]{1.25} &
    \placeholder[4]{2.25} &
    \elemsafter \\
};

\matrix at (b1) [fptk, list=c, element=a] {
    \elem{1} &
    \elem{2} \\
}; 

\matrix at (b2) [fptk, list=c, element=a] { 
    \elem{3} \\ 
};

\matrix at (b3) [fptk, list=c, element=a] {
    \elem{4} \\
};

\matrix at (b4) [fptk, list=c, element=a] {
    \elem{5} &
    \elem{6} \\
};

\bracetobrace
    {a2.south east}{a1.south west}
    {b1.north west}{b1.north east}

\draw [fptk, flow ->] (a3.south) -- (b2.north);
\draw [fptk, flow ->] (a4.south) -- (b3.north);

\bracetobrace
    {a6.south east}{a5.south west}
    {b4.north west}{b4.north east}
