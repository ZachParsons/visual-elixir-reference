\matrix [fptk, list=a] {
    \elemx{11}{$a_1$} &
    \elemx{21}{$a_2$} &
    \elemx{12}{$a_1$} &
    \elems &
    \elemx{n1}{$a_n$} &
    \elemx{22}{$a_2$} &
    \elems &
    \elemx{13}{$a_1$} &
    \elemx{n2}{$a_n$} \\
};

\foreach \i/\j/\d in {
    11/1/.5,
    12/1/.5,
    13/1/.5,
    21/2/1.5,
    22/2/1.5,
    n1/n/2.5,
    n2/n/2.5
}{
    \draw [fptk, subflow ->, shorten >=1ex] (a\i.north) -- +(0, \d)
        node (v\i) [anchor=base] {$a_\j$};
}

\draw [fptk, group] (v11.center) -- (v13.center);
\draw [fptk, group] (v21.center) -- (v22.center);
\draw [fptk, group] (vn1.center) -- (vn2.center);

\matrix [fptk, list=b, below=2 of a] {
    \elem{1} &
    \elem{2} &
    \elems &
    \elem{n} \\
};

\draw [fptk, flow ->=soft] (a11.south) to (b1.north);
\draw [fptk, flow ->=soft] (a21.south) to (b2.north);
\draw [fptk, flow ->=soft] (an1.south) to (bn.north);
